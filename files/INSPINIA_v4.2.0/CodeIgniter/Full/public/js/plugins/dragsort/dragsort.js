((t,e)=>{var s={};"function"==typeof s&&s.amd?s([],e):"object"==typeof exports&&"object"==typeof module?module.exports=e():"object"==typeof exports?exports.DragSort=e():t.DragSort=e()})(this,function(){var i,s=0,r={},a={};function n(t,e){if(!t)return this;var s;e=e||{},this.parentElm=t,this.uid=e.uid,this.settings={selector:"*",callbacks:{}},Object.assign(this.settings,e),this.setup(),t=this.parentElm,s=this.setup.bind(this),t&&1===t.nodeType&&(i?new i(function(t,e){s(t)}).observe(t,{childList:!0,subtree:!1}):window.addEventListener&&t.addEventListener("DOMNodeInserted",s,!1)),this.bindEvents()}return i=window.MutationObserver||window.WebKitMutationObserver,n.prototype={namespace:"dragsort",setup(){[...this.parentElm.childNodes].forEach(t=>{if(1!=t.nodeType)return t.parentNode.removeChild(t);t.matches(this.settings.selector)&&(t.draggable=!0)}),this.gap=this.getItemsGap(this.parentElm.firstElementChild)},throttle(e,s){var i=!1,r=this;return function(t){i||(e.call(r,t),i=!0,setTimeout(()=>i=!1,s))}},getDraggableElm(t){return t.closest&&(t=t.closest('[draggable="true"]'),this.uid==r.uid)?t:null},dragstart(t,e){var s;(e=(r=this).getDraggableElm(e))?(this.saveInitialStyles(),this.source=this.getInitialState(),this.target=this.getInitialState(),s=e.getBoundingClientRect(),this.source.elm=e,this.source.idx=this.getNodeIndex(e),this.source.size.width=s.width,this.source.size.height=s.height,t.dataTransfer.effectAllowed="move",this.settings.callbacks.dragStart&&this.settings.callbacks.dragStart(this.source.elm,t),setTimeout(this.afterDragStart.bind(this))):r={}},afterDragStart(){var t="vertical"==this.settings.mode?"height":"width";this.parentElm.classList.add(this.namespace+"--dragStart"),this.source.elm.style[t]=this.source.size[t]+"px",this.source.elm.classList.add(this.namespace+"--dragElem")},dragover(t){t.preventDefault(),t.stopPropagation();var e,s,i=t.target;(i=this.getDraggableElm(i))&&this.target&&(e=this.target.elm,s=this.target.hoverDirection,t.dataTransfer.dropEffect="move",this.target.hoverDirection=this.getTargetDirection(t),e==i&&s==this.target.hoverDirection||this.directionAwareDragEnter(t,i))},dragenter(t,e){(e=this.getDraggableElm(e))&&this.target&&this.isValidElm(e)&&this.source.elm!=e&&this.source.elm&&(this.target.bounding=e.getBoundingClientRect())},directionAwareDragEnter(t,e){t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect="none",this.isValidElm(e)&&this.source.elm!=e&&this.source.elm&&(t.dataTransfer.dropEffect="move",this.cleanupLastTarget(),this.target.elm=e,this.target.idx=this.getNodeIndex(e),e.classList.add("over"),t=Math.abs(this.target.idx-this.source.idx),this.source.elm.classList.toggle(this.namespace+"--hide",0<t),"vertical"==this.settings.mode?this.target.elm.style[this.target.hoverDirection?"marginBottom":"marginTop"]=this.source.size.height+this.gap+"px":this.target.elm.style[this.target.hoverDirection?"marginRight":"marginLeft"]=this.source.size.width+this.gap+"px")},dragend(t){var e;return clearTimeout(this.dragoverTimeout),this.dragoverTimeout=null,this.parentElm.classList.remove(this.namespace+"--dragStart"),this.isValidElm(this.target.elm)?(e=this.target.hoverDirection?this.target.elm.nextElementSibling:this.target.elm,this.source.elm!=this.target.elm&&this.target.elm&&(this.target.elm.classList.add(this.namespace+"--noAnim"),this.cleanup(),this.parentElm.insertBefore(this.source.elm,e)),this.source.elm&&this.source.elm.classList.remove(this.namespace+"--dragElem",this.namespace+"--hide"),this.settings.callbacks.dragEnd&&this.settings.callbacks.dragEnd(this.source.elm),this):this.cleanup()},isTargetLastChild(){return this.parentElm.lastElementChild==this.target.elm},getTargetDirection(t){if(this.target.bounding)return"vertical"==this.settings.mode?t.pageY>this.target.bounding.top+this.target.bounding.height/2?1:0:t.pageX>this.target.bounding.left+this.target.bounding.width/2?1:0},getNodeIndex(t){for(var e=0;t=t.previousSibling;)3==t.nodeType&&/^\s*$/.test(t.data)||e++;return e},isValidElm(t){return t&&t.nodeType&&t.parentNode==this.parentElm},saveInitialStyles(){[...this.parentElm.children].forEach(t=>{t.setAttribute("dragsort-initial-style",t.getAttribute("style"))})},cleanup(){r={},[...this.parentElm.children].forEach(t=>{t.style=t.getAttribute("dragsort-initial-style"),t.removeAttribute("dragsort-initial-style"),setTimeout(()=>{t.classList.remove(this.namespace+"--over",this.namespace+"--noAnim",this.namespace+"--dragElem")},50)})},cleanupLastTarget(){var t=this.target.elm;t&&(t.classList.remove(this.namespace+"--hide",this.namespace+"--over"),t.style=t.getAttribute("dragsort-initial-style"))},getInitialState:()=>({elm:null,size:{}}),getItemsGap(t){var e=getComputedStyle(t),t=getComputedStyle(t.parentNode),s="vertical"==this.settings.mode,t=parseInt(t.gap)||0;return parseInt(e["margin"+(s?"Top":"Left")])+parseInt(e["margin"+(s?"Bottom":"Right")])+t},bindEvents(t){for(var e in this.listeners=this.listeners||{dragstart:t=>this.dragstart(t,t.target),dragenter:t=>this.dragenter(t,t.target),dragend:t=>this.dragend(t,t.target),dragover:this.throttle(this.dragover,350)},this.listeners)this.parentElm[t?"removeEventListener":"addEventListener"](e,this.listeners[e])},destroy(){this.cleanup(),this.bindEvents(!0),delete a[this.uid]}},function(t,e){return a[++s]=t.DragSort?a[t.DragSort]:new n(t,{...e,uid:s}),a[t.DragSort=s]}});